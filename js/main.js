// Generated by CoffeeScript 1.4.0
(function() {
  var Food, MainSnake, MirrorSnake, areAtSamePlace, atFrameRate, bindEvents, collision, drawingCanvas, gridHeight, gridWidth, nextColor, randomPosition, _currentColor;

  $(function() {
    var food, mainLoop, mainSnake, mirrorSnakes;
    drawingCanvas.init();
    mainSnake = new MainSnake;
    mirrorSnakes = [];
    food = new Food;
    bindEvents(mainSnake);
    mainLoop = function() {
      var snake, _i, _len;
      drawingCanvas.clear();
      mainSnake.move();
      food.render();
      if (areAtSamePlace(mainSnake, food)) {
        mirrorSnakes.push(new MirrorSnake({
          of: mainSnake,
          color: food.color
        }));
        food.regenerate();
      }
      for (_i = 0, _len = mirrorSnakes.length; _i < _len; _i++) {
        snake = mirrorSnakes[_i];
        snake.move();
        snake.render();
        if (collision(mainSnake, snake)) {
          console.log('dead');
        }
      }
      return mainSnake.render();
    };
    return atFrameRate(20)["do"](mainLoop);
  });

  gridWidth = 100;

  gridHeight = 50;

  atFrameRate = function(frameRate) {
    return {
      "do": function(action) {
        return setInterval(action, 1000 / frameRate);
      }
    };
  };

  _currentColor = -1;

  nextColor = function() {
    var colors;
    colors = ['#bc2424', '#2abc24', '#2461bc', '#6c24bc', '#b6bc24', '#24bca3', '#0e2ba6', '#a60e93'];
    _currentColor = (_currentColor + 1) % colors.length;
    return colors[_currentColor];
  };

  randomPosition = function() {
    return {
      x: Math.round(Math.random() * gridWidth),
      y: Math.round(Math.random() * gridHeight)
    };
  };

  areAtSamePlace = function(oneThing, otherThing) {
    return oneThing.position.x === otherThing.position.x && oneThing.position.y === otherThing.position.y;
  };

  collision = function(oneSnake, anotherSnake) {
    return false;
  };

  drawingCanvas = {
    $el: null,
    el: null,
    ctx: null,
    init: function() {
      var minGridSize;
      this.$el = $('canvas');
      this.el = this.$el[0];
      this.el.width = this.$el.width();
      this.el.height = this.$el.height();
      minGridSize = 50;
      if (this.el.height < this.el.width) {
        gridHeight = minGridSize;
        gridWidth = Math.round(minGridSize * this.el.width / this.el.height);
      } else {
        gridHeight = Math.round(minGridSize * this.el.height / this.el.width);
        gridWidth = minGridSize;
      }
      return this.ctx = this.el.getContext('2d');
    },
    clear: function() {
      return this.ctx.clearRect(0, 0, this.el.width, this.el.height);
    },
    drawSquare: function(x, y, color) {
      this.ctx.fillStyle = color;
      return this.ctx.fillRect(x * this.el.width / gridWidth, y * this.el.height / gridHeight, this.el.width / gridWidth, this.el.height / gridHeight);
    }
  };

  bindEvents = function(snake) {
    var changeDirection;
    changeDirection = function(e) {
      if (e.keyCode === 37 && snake.direction !== 'right') {
        return snake.direction = 'left';
      } else if (e.keyCode === 38 && snake.direction !== 'down') {
        return snake.direction = 'up';
      } else if (e.keyCode === 39 && snake.direction !== 'left') {
        return snake.direction = 'right';
      } else if (e.keyCode === 40 && snake.direction !== 'up') {
        return snake.direction = 'down';
      }
    };
    return $(window).on('keydown', changeDirection);
  };

  MainSnake = (function() {

    MainSnake.prototype.length = 6;

    function MainSnake() {
      this.position = {
        x: Math.round(gridWidth / 2),
        y: Math.round(gridHeight / 2)
      };
      this.history = [];
      this.color = '#ededed';
      this.direction = 'right';
    }

    MainSnake.prototype.move = function() {
      if (this.direction === 'right') {
        this.position.x += 1;
        if (this.position.x >= gridWidth) {
          this.position.x = 0;
        }
      } else if (this.direction === 'left') {
        this.position.x -= 1;
        if (this.position.x < 0) {
          this.position.x = gridWidth - 1;
        }
      } else if (this.direction === 'up') {
        this.position.y -= 1;
        if (this.position.y < 0) {
          this.position.y = gridHeight - 1;
        }
      } else {
        this.position.y += 1;
        if (this.position.y >= gridHeight) {
          this.position.y = 0;
        }
      }
      return this.history.push({
        x: this.position.x,
        y: this.position.y
      });
    };

    MainSnake.prototype.render = function() {
      var i, position, _i, _j, _len, _ref, _results, _results1;
      if (this.history.length < 6) {
        _ref = this.history;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          position = _ref[_i];
          _results.push(drawingCanvas.drawSquare(position.x, position.y, this.color));
        }
        return _results;
      } else {
        _results1 = [];
        for (i = _j = 1; _j < 6; i = ++_j) {
          _results1.push(drawingCanvas.drawSquare(this.history[this.history.length - i].x, this.history[this.history.length - i].y, this.color));
        }
        return _results1;
      }
    };

    return MainSnake;

  })();

  MirrorSnake = (function() {

    function MirrorSnake(params) {
      this.params = params;
      this.color = this.params.color;
      this.originalSnake = this.params.of;
      this.offset = 0;
    }

    MirrorSnake.prototype.move = function() {
      return this.offset += 1;
    };

    MirrorSnake.prototype.render = function() {
      var i, position, _i, _results;
      _results = [];
      for (i = _i = 0; _i <= 6; i = ++_i) {
        position = this.originalSnake.history[this.offset + i];
        _results.push(drawingCanvas.drawSquare(position.x, position.y, this.color));
      }
      return _results;
    };

    return MirrorSnake;

  })();

  Food = (function() {

    function Food() {
      this.position = randomPosition();
      this.color = nextColor();
    }

    Food.prototype.render = function() {
      return drawingCanvas.drawSquare(this.position.x, this.position.y, this.color);
    };

    Food.prototype.regenerate = function() {
      this.position = randomPosition();
      return this.color = nextColor();
    };

    return Food;

  })();

}).call(this);
